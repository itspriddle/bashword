name: Tests

on: [push]

jobs:
  shellcheck:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Run shellcheck
        run: |
          sudo apt-get update -y
          sudo apt-get install shellcheck
          make test-shellcheck

  linux:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Run bats tests on Ubuntu
        # shell: 'script -q -e -c "bash {0}"'
        env:
          TERM: linux
        run: |
          curl -s -L "https://gist.github.com/itspriddle/3527c7018aeb32f456c3cfa3f6b5c22f/raw/0714192788a8f0336648adae9c4c8be2d5e8d2d3/words.gz" | gunzip > /tmp/bashwords-words
          LC_CTYPE=C LC_ALL=C tr -dc "[:alpha:]" < /dev/urandom 2>/dev/null | dd bs=1 count="1" 2>/dev/null || true
          # wc -l /usr/share/dict/words
          bash --version
          make test-bats

  # windows:
  #   runs-on: windows-2019
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Run bats tests on Windows
  #       run: |
  #         bash --version
  #         make test-bats

  # macos:
  #   runs-on: macos-11
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Install unbuffer via expect
  #       run: brew install expect
  #     - name: Run bats tests on macOS
  #       shell: 'unbuffer bash {0}'
  #       env:
  #         TERM: linux
  #       run: |
  #         bash --version
  #         make test-bats
